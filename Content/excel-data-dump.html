<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Winshuttle</title>
        <link href="assets/css/kendo.common.min.css" rel="stylesheet">
        <link href="assets/css/kendo.default.min.css" rel="stylesheet">
        <link href="assets/css/kendo.dataviz.min.css" rel="stylesheet">
        <link href="assets/css/kendo.dataviz.default.min.css" rel="stylesheet">
        <link href="assets/css/winshuttle.css" rel="stylesheet">
        <link href="assets/css/ws-formitems.css" rel="stylesheet">
        <link href="assets/css/chosen.css" rel="stylesheet">
    </head>
    <body>
        <div id="workflow-header">
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span6">
                        <div class="workflow-brand">
                            <img src="assets/img/ws-logo-workflow.png" alt="Winshuttle">
                            <div class="home-dropdown">
                                <div class="btn-group">
                                    <a class="btn btn-action dropdown-toggle" data-toggle="dropdown" href="#"></a>
                                    <ul class="dropdown-menu">
                                        <div>
                                            <li class="dropdown-title">Logs &amp; Reporting</li>
                                            <li><a href="#">Charts</a></li>
                                            <li><a href="#">Excel Data Dump</a></li>
                                            <li><a href="#">Logging</a></li>
                                            <li><a href="#">Log File Viewer</a></li>
                                            <li class="dropdown-title">Processes</li>
                                            <li><a href="#">Process Control</a></li>
                                            <li><a href="#">Manage Background Jobs</a></li>
                                        </div>
                                        <div>
                                            <li class="dropdown-title">Server Administration</li>
                                            <li><a href="#">Admin Commands</a></li>
                                            <li><a href="#">Configure Options</a></li>
                                            <li><a href="#">Scheduler</a></li>
                                            <li><a href="#">Workflow Extensions</a></li>
                                            <li><a href="#">Database Status</a></li>
                                            <li><a href="#">Licenses</a></li>
                                        </div>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="span6">
                        <ul class="inline-list pull-right">
                            <!--<li>
                                <a class="font-white" href="javascript:;">&#9664; Winshuttle Central</a>
                                </li>-->
                            <li>
                                <select id="select-webapp">
                                </select>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div id="mainsi">
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span12">
                        <ul id="breadcrumbs">
                            <li><a href="#">Administration</a> &rsaquo;</li>
                            <li><a href="#">Logs & Reporting</a></li>
                            <li class="related-links">
                                <ul>
                                    <li class="related-label">Related:</li>
                                    <li class="link"><a href="#">Log File Viewer</a></li>
                                    <li class="link"><a href="#">Charts</a></li>
                                    <li class="link"><a href="#">Scheduler</a></li>
                                </ul>
                            </li>
                        </ul>
                        <ul id="secnav">
                            <li id="js-header" class="active">
                                <h1>Excel Workflow Data Dump</h1>
                                <div class="row-fluid">
                                    <div class="span8 page-description">Page description goes here.  If no page description exists, delete this paragraph.  Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</div>
                                </div>
                                <div class="tooltip" role="tooltip">
                                    <div class="tooltip-inner">
                                        This operation can be time consuming, so it will run in the background. Users will be notified on completion, if email addresses are entered.
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span8">
                        <div class="settings-info">
                            <form id="form-data" class="form-horizontal">
                                <fieldset>
                                    <div class="control-group">
                                        <label class="control-label">Site <span class="required">*</span></label>
                                        <div class="controls">
                                            <select id="select-site" data-generation-level="1" data-generationdropdown-id="location" class="js-admincommands-form-field-generation input-max">
                                                <option value="N/A">Select</option>
                                            </select>
                                            <div class="help-block">Only fully-qualified SharePoint sites are available.</div>
                                        </div>
                                    </div>
                                    <div class="control-group">
                                        <label class="control-label">Save To <span class="required">*</span></label>
                                        <div class="controls">
                                            <select id="select-doclib" data-generation-level="2" data-generationdropdown-id="location" class="js-admincommands-form-field-generation input-max" disabled="disabled">
                                                <option value="N/A">Select</option>
                                            </select>
                                            <div class="help-block">Document Library to save data dump in.</div>
                                        </div>
                                    </div>
                                    <div class="control-group">
                                        <label class="control-label">File Extension <span class="required">*</span></label>
                                        <div class="controls">
                                            <select id="select-ext" class="input-onethirds">
                                                <option value="N/A">Select file type</option>
                                                <option value=".html">.html</option>
                                                <option value=".csv">.csv</option>
                                                <option value=".xls">.xls</option>
                                                <option value=".txt">.txt</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="control-group">
                                        <label class="control-label">Send Notification to</label>
                                        <div class="controls string-max">
                                            <input id="input-email" type="text"  class="input-max" placeholder="user@winshuttle, user@email.com">
                                        </div>
                                    </div>
                                    <div class="form-actions top-line">
                                        <button id="btn-save" class="btn btn-primary"><span>Save</span></button>
                                        <button class="btn"><span>Cancel</span></button>
                                    </div>
                                </fieldset>
                            </form>
                        </div>
                    </div>
                    <!-- /div .span8 -->
                </div>
                <!-- /div .row-fluid -->
            </div>
            <!-- /div .container-fluid -->
        </div>
        <!-- /div #mainsi -->
        <div id="footer" class="row-fluid">
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span8">
                        <div id="footer-links">
                            <ul>
                                <li><a href="#">Help</a></li>
                                <li><a href="#">About</a></li>
                                <li><a href="#">Terms</a></li>
                                <li><a href="#">Privacy Policy</a></li>
                            </ul>
                            <ul>
                                <li>&copy; 2008-2011 Winshuttle, LLC</li>
                                <li>Version 10.4</li>
                                <li>Privacy Mode: Secure</li>
                            </ul>
                        </div>
                    </div>
                    <div class="span4">
                        <ul class="security-logo">
                            <li><img src="assets/img/security-te.png" alt="TRUSTe"/></li>
                            <li><img src="assets/img/security-sh.png" alt="Safe Harbor"/></li>
                            <li><img src="assets/img/security-soc.png" alt="SSAE 16 / ISAE 3402 Type II SOC 1"/></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script>
            if (!window.jQuery) {
                console.error("jQuery CDN is down.");
                document.write('<script src="assets/js/jquery.min.js"><\/script>');
            }
        </script>
        <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
        <script>
            if (!$.fn.modal) {
                console.error("Bootstrap CDN is down.");
                document.write('<script src="assets/js/bootstrap.min.js"><\/script>');
            }
        </script>
        <script src="assets/js/kendo.all.min.js"></script>
        <script src="assets/js/chosen.jquery.min.js"></script>
        <script src="assets/js/wslib_master.js"></script>
        <script src="assets/js/wsplugin_master.js"></script>
        <script src="assets/js/ws_workflow_admin.js"></script>
        <script src="assets/js/ws_common.js"></script>
        <script>
            $('.chzn-select').chosen();

            $(document).ready(function () {
                ws_showProgressBar();
                ws_initializeWebApp('/admin/GetAllWebApp', $('#select-webapp'), function () {

                    load();

                    $("#select-site").on("change", function () {
                        ws_showProgressBar();
                        var selected = $(this).find("option:selected").val();
                        $("#select-doclib").find("option:not(:first)").remove();

                        if (selected == 'N/A') {
                            $("#select-doclib").prop('disabled', 'disabled');
                            return;
                        }

                        ws_ajaxCall('/admin/getalldoclib', { site: $webappUrl + selected }, function (data) {
                            var options = '';
                            $.each(data, function (key, value) {

                                options += '<option value="' + value.Name + '">' + value.Name + '</option>';
                            });

                            $("#select-doclib").append(options);
                            $("#select-doclib").prop('disabled', '');
                            ws_hideProgressBar();
                        }, null, null);
                    });

                    $('#select-webapp').on('change', function () {

                        window.location.href = 'excel-data-dump.html?server=' + $('#select-webapp :selected').val();
                    });

                    $("#btn-save").on("click", function () {
                        ws_showProgressBar();
                        var siteurl = $("#select-site option:selected").val();
                        var list = $("#select-doclib option:selected").val();
                        var email = $("#input-email").val();
                        var ext = $("#select-ext option:selected").val();
                        var data = { webappUrl: $webappUrl, siteUrl: siteurl, doclib: list, email: email, ext: ext };
                        ws_ajaxCall('/workflowdump/dump', data, function (successData) {

                            ws_hideProgressBar();

                        }, null, null);

                        return false;
                    });
                });
            });

            function load() {
                var $webappUrl = getServer();
                $('#select-webapp').val($webappUrl);

                ws_ajaxCall('/admin/getallsites', { server: $webappUrl }, function (data) {

                    var options = '';
                    $.each(data, function (key, value) {

                        options += '<option value="' + value.ServerRelativeURL + '">' + value.Name + '</option>';
                    });

                    $("#select-site").append(options);
                    ws_hideProgressBar();
                }, null, null);
            }

            function getServer() {

                var server = wsPlugin_getURLParameter('server');
                if (server == undefined || server == null || server == '') {
                    server = $('#select-webapp :selected').val();
                }

                return server;
            }
            
        </script>
    </body>
</html>