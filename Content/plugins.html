<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Winshuttle - Plugins</title>
        <link href="assets/css/kendo.common.min.css" rel="stylesheet">
        <link href="assets/css/kendo.default.min.css" rel="stylesheet">
        <link href="assets/css/kendo.dataviz.min.css" rel="stylesheet">
        <link href="assets/css/kendo.dataviz.default.min.css" rel="stylesheet">
        <link href="assets/css/winshuttle.css" rel="stylesheet">
        <link href="assets/css/ws-formitems.css" rel="stylesheet">
    </head>
    <body>
        <div id="workflow-header">
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span6">
                        <div class="workflow-brand">
                            <img src="assets/img/ws-logo-workflow.png" alt="Winshuttle"/>
                            <div class="home-dropdown">
                                <div class="btn-group">
                                    <a class="btn btn-action dropdown-toggle" data-toggle="dropdown" href="#"></a>
                                    <ul class="dropdown-menu">
                                        <div>
                                            <li class="dropdown-title">Logs &amp; Reporting</li>
                                            <li><a href="#">Charts</a></li>
                                            <li><a href="#">Excel Data Dump</a></li>
                                            <li><a href="#">Logging</a></li>
                                            <li><a href="#">Log File Viewer</a></li>
                                            <li class="dropdown-title">Processes</li>
                                            <li><a href="#">Process Control</a></li>
                                            <li><a href="#">Manage Background Jobs</a></li>
                                        </div>
                                        <div>
                                            <li class="dropdown-title">Server Administration</li>
                                            <li><a href="#">Admin Commands</a></li>
                                            <li><a href="#">Configure Options</a></li>
                                            <li><a href="#">Scheduler</a></li>
                                            <li><a href="#">Workflow Extensions</a></li>
                                            <li><a href="#">Database Status</a></li>
                                            <li><a href="#">Licenses</a></li>
                                        </div>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="span6">
                        <ul class="inline-list pull-right">
                            <!--<li>
                                <a class="font-white" href="javascript:;">&#9664; Winshuttle Central</a>
                                </li>-->
                            <li>
                                <select class="input-medium" id="select-webapp">
                                </select>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div id="mainsi">
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span12">
                        <ul id="breadcrumbs">
                            <li><a href="#">Administration</a> &rsaquo;</li>
                            <li><a href="#">Extend Workflow</a></li>
                            <li class="related-links">
                                <ul>
                                    <li class="related-label">Related:</li>
                                    <li class="link"><a href="#">Workflow Extensions</a></li>
                                    <li class="link"><a href="#">Participant Resolvers</a></li>
                                    <li class="link"><a href="#">InfoPath Form Controllers</a></li>
                                </ul>
                            </li>
                        </ul>
                        <ul id="secnav">
                            <li class="pull-right">
                                <button id="btn-plugin-add" class="btn pull-right"><span>Add Plugin</span></button>
                            </li>
                            <li class="active">
                                <h1>Plugins</h1>
                                <p class="page-description">Page description goes here.  If no page description exists, delete this paragraph.  Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="row-fluid">
                    <table class="table table-header">
                        <tbody>
                            <tr>
                                <td>
                                    <form id="form-plugin">
                                        <div>
                                            <label>Plugin name contains</label>
                                            <input type="text" name="name" id="input-plugin-name" class="form-control input-large" placeholder="">
                                        </div>
                                        <div>
                                            <label>Plugin Definition contains</label>
                                            <input type="text" name="def" id="input-plugin-def" class="form-control input-large" placeholder="">
                                        </div>
                                        <div>
                                            <label>&nbsp;</label>
                                            <button class="btn btn-primary" id="btn-search"><span>Search</span></button>
                                        </div>
                                    </form>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="row-fluid">
                    <div class="span12">
                        <table class="table table-scheduler table-striped table-bordered" id="table-plugin-list">
                            <thead>
                                <tr class="table-menu">
                                    <th colspan="2">
                                        <div class="display">
                                            <span>Displaying 1 - 50 of 125 <a href="#" onclick="return exportList()">Export</a></span>
                                            <select name="" onchange="" class="input-small">
                                                <option selected="selected" value="20">20</option>
                                                <option value="50">50</option>
                                                <option value="100">100</option>
                                                <option value="200">200</option>
                                                <option value="500">500</option>
                                            </select>
                                        </div>
                                    </th>
                                </tr>
                                <tr class="table-sort">
                                    <th><a href="#">Plugin Name</a></th>
                                    <th><a href="#">Plugin Definition</a></th>
                                </tr>
                            <tbody></tbody>
                        </table>
                        <ul class="pagination">
                            <li><a href="#" class="btn btn-disabled"><span>&larr;</span></a></li>
                            <li><a href="#" class="btn btn-primary"><span>1</span></a></li>
                            <li><a href="#" class="btn"><span>2</span></a></li>
                            <li><a href="#" class="btn"><span>3</span></a></li>
                            <li><a href="#" class="btn"><span>&rarr;</span></a></li>
                        </ul>
                    </div>
                    <!-- /div .span8 -->
                </div>
                <!-- /div .row-fluid -->
            </div>
            <!-- /div .container-fluid -->
        </div>
        <!-- /div #mainsi -->
        <div id="footer" class="row-fluid">
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span8">
                        <div id="footer-links">
                            <ul>
                                <li><a href="#">Help</a></li>
                                <li><a href="#">About</a></li>
                                <li><a href="#">Terms</a></li>
                                <li><a href="#">Privacy Policy</a></li>
                            </ul>
                            <ul>
                                <li>&copy; 2008-2011 Winshuttle, LLC</li>
                                <li>Version 10.4</li>
                                <li>Privacy Mode: Secure</li>
                            </ul>
                        </div>
                    </div>
                    <div class="span4">
                        <ul class="security-logo">
                            <li><img src="assets/img/security-te.png" alt="TRUSTe"/></li>
                            <li><img src="assets/img/security-sh.png" alt="Safe Harbor"/></li>
                            <li><img src="assets/img/security-soc.png" alt="SSAE 16 / ISAE 3402 Type II SOC 1"/></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script>
            if (!window.jQuery) {
                console.error("jQuery CDN is down.")
                document.write('<script src="assets/js/jquery.min.js"><\/script>');
            }
        </script>
        <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
        <script>
            if (!$.fn.modal) {
                console.error("Bootstrap CDN is down.")
                document.write('<script src="assets/js/bootstrap.min.js"><\/script>');
            }
        </script>
        <script src="assets/js/kendo.all.min.js"></script>
        <script src="assets/js/chosen.jquery.min.js"></script>
        <script src="assets/js/wslib_master.js"></script>
        <script src="assets/js/wsplugin_master.js"></script>
        <script src="assets/js/ws_common.js"></script>
        <script>
            $('a.js-tooltip-target').tooltip({
                html: true,
                trigger: 'click',
                animation: true
            });
            
            $('body').on('click', '.js-tooltip-target', function(event) {
                event.stopPropagation();
                
                $('div.tooltip').not($(this).siblings('div.tooltip')).remove();
            });

            function load(data, callbackdata) {

                var webapp = getServer();
                $('#select-webapp').val(webapp);
                var data = "url=" + webapp;
                loadPlugins('/serverconfig/getallplugins', data, 1);
            }

            $(document).ready(function () {

                ws_showProgressBar();
                ws_initializeWebApp('/admin/getallwebapp', $('#select-webapp'), function (data, callbackdata) {
                    load(data, callbackdata);
                });

                $('#btn-search').on('click', function () {
                    ws_showProgressBar();
                    var webapp = $('#select-webapp option:selected').val();
                    var url = '/serverconfig/getplugins';
                    var name = $('#input-plugin-name').val();
                    var def = $('#input-plugin-def').val();
                    var data = 'name=' + name + "&url=" + webapp + '&def=' + def;

                    if (name == '' && def == '') {
                        url = '/serverconfig/getallplugins';
                        data = "url=" + webapp;
                    }

                    loadPlugins(url, data, 1);
                    return false;
                });

                $('#btn-plugin-add').on('click', function () {

                    window.location.href = "plugin-new.html";
                    return false;
                });

                $('#select-webapp').on('change', function () {

                    window.location.href = 'plugins.html?server=' + $('#select-webapp option:selected').val();
                });

                return false;
            });

            function fillTable(data, callbackdata) {

                $('#table-plugin-list tbody tr').remove();
                $.each(data, function (key, value) {

                    var row = '<tr><td class="table-dropdown"><span>' + value.Name + '</span><div class="btn-group"><a class="btn btn-actiondropdown-toggle" data-toggle="dropdown" href="#"></a><ul class="dropdown-menu"><li><a href="plugin-edit.html?name=' + value.Name + '">Edit</a></li><li><a href="#" onclick="callDelete(' + value.Id + ')">Delete</a></li></ul></div></td><td>' + ws_getEncodedData(value.MetaData) + '</td></tr>';

                    $('#table-plugin-list tbody').append(row);
                });

                ws_hideProgressBar();
            }

            function onError(xhr, status, error) {
                ws_hideProgressBar();
            }

            function loadPlugins(url, data, curPage) {
                data += '&curPage=' + curPage;

                ws_ajaxCall(url, data, fillTable, onError, null);
            }

            function callDelete(id) {
                ws_showProgressBar();
                var webapp = $('#select-webapp option:selected').val();
                ws_ajaxCall('/serverconfig/DeletePlugin', { url: webapp, id: id }, function (data, callbackdata) {

                    $('#btn-search').click();
                }, onError, null);
            }

            function exportList() {
                var webapp = $('#select-webapp option:selected').val();
                var name = $('#input-plugin-name').val();
                window.open('/serverconfig/export?url=' + webapp + '&name=' + name);
            }

            function getServer() {

                var server = wsPlugin_getURLParameter('server');
                if (server == undefined || server == null || server == '') {
                    server = $('#select-webapp :selected').val();
                }

                return server;
            }
            
        </script>
    </body>
</html>