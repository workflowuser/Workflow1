<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Winshuttle</title>
        <link href="assets/css/kendo.common.min.css" rel="stylesheet">
        <link href="assets/css/kendo.default.min.css" rel="stylesheet">
        <link href="assets/css/kendo.dataviz.min.css" rel="stylesheet">
        <link href="assets/css/kendo.dataviz.default.min.css" rel="stylesheet">
        <link href="assets/css/chosen.css" rel="stylesheet">
        <link href="assets/css/winshuttle.css" rel="stylesheet">
        <link href="assets/css/alert.css" rel="stylesheet">
        <link href="assets/css/ws-formitems.css" rel="stylesheet">
    </head>
    <body>
        <div id="workflow-header">
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span6">
                        <div class="workflow-brand">
                            <img src="assets/img/ws-logo-workflow.png" alt="Winshuttle">
                            <div class="home-dropdown">
                                <div class="btn-group">
                                    <a class="btn btn-action dropdown-toggle" data-toggle="dropdown" href="#"></a>
                                    <ul class="dropdown-menu">
                                        <div>
                                            <li class="dropdown-title">Logs &amp; Reporting</li>
                                            <li><a href="#">Charts</a></li>
                                            <li><a href="#">Excel Data Dump</a></li>
                                            <li><a href="#">Logging</a></li>
                                            <li><a href="#">Log File Viewer</a></li>
                                            <li class="dropdown-title">Processes</li>
                                            <li><a href="#">Process Control</a></li>
                                            <li><a href="#">Manage Background Jobs</a></li>
                                        </div>
                                        <div>
                                            <li class="dropdown-title">Server Administration</li>
                                            <li><a href="#">Admin Commands</a></li>
                                            <li><a href="#">Configure Options</a></li>
                                            <li><a href="#">Scheduler</a></li>
                                            <li><a href="#">Workflow Extensions</a></li>
                                            <li><a href="#">Database Status</a></li>
                                            <li><a href="#">Licenses</a></li>
                                        </div>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="span6">
                        <ul class="inline-list pull-right">
                            <!--<li>
                                <a class="font-white" href="javascript:;">&#9664; Winshuttle Central</a>
                                </li>-->
                            <li>
                                <select class="input-medium" id="select-webapp">
                                    <option>Sharepoint - 80</option>
                                </select>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div id="mainsi">
            <div class="container-fluid">
                <div class="container-alert">
                    <div id="js-alert-licensekey-copied" class="alert alert-success alert-dismissible js-initial-hide" role="alert">
                        License key has been copied to clipboard.
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span12">
                        <ul id="breadcrumbs">
                            <li><a href="#">Administration</a> &rsaquo;</li>
                            <li><a href="#">Server Administration</a></li>
                        </ul>
                        <ul id="secnav">
                            <li class="active">
                                <h1>Winshuttle Licensing</h1>
                                <div class="row-fluid">
                                    <div class="span8 page-description">Page description goes here.  If no page description exists, delete this paragraph.  Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span12">
                        <table class="js-table table table-striped table-bordered" id="table-license">
                            <thead class="table-sort">
                                <tr>
                                    <th>
                                        <a href="#">
                                            Host Name
                                        </a>
                                    </th>
                                    <th>
                                        <a href="#">
                                            Company
                                        </a>
                                    </th>
                                    <th>
                                        <a href="#">
                                            Process
                                        </a>
                                    </th>
                                    <th>
                                        <a href="#">
                                            Expiry Date
                                        </a>
                                    </th>
                                    <th>
                                        <a href="#">
                                            Environment
                                        </a>
                                    </th>
                                    <th>
                                        <a href="#">
                                            Key
                                        </a>
                                    </th>
                                    <th class="no-sort">
                                        &nbsp;
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="table-body-license">
                                <!-- ### SAMPLE BELOW ### -->
                                <tr>
                                    <td>WFSERVER4</td>
                                    <td>ABC</td>
                                    <td>null</td>
                                    <td>04-12-2014</td>
                                    <td></td>
                                    <td class="license-key">
                                        <a href="#" class="js-modal-licensekey-target" data-toggle="modal" data-target="#js-modal-copymenu" data-ws-licensekey="vcYxFoLHQ3nAWiSrUu3hGhUjGzMSxj3KOWwLt81m/ArOYFIbvkkfnjdLkoqQ1GUhrLS3FQ+XWv8n9gISuy4isOGKSgjuyuah1oO4jl6gP1hNx1MzWBavJCnC/ekOWx604qwHzVsoZbJJvwdCftFxlb24XmVcdNGnFqLSHzfiU18EAE1pzLuEDg5VcQalB4J2">
                                            <span>#####...</span>
                                        </a>
                                    </td>
                                    <td>
                                        <a href="#">
                                            <i class="icon-trash"></i>
                                        </a>
                                    </td>
                                </tr>
                                <tr>
                                    <td>LOREM</td>
                                    <td>IPSUM</td>
                                    <td>null</td>
                                    <td>XX-XX-XXXX</td>
                                    <td></td>
                                    <td class="license-key">
                                        <a href="#" class="js-modal-licensekey-target" data-toggle="modal" data-target="#js-modal-copymenu" data-ws-licensekey="SAMPLE KEY">
                                            <span>#####...</span>
                                        </a>
                                    </td>
                                    <td>
                                        <a href="#">
                                            <i class="icon-trash"></i>
                                        </a>
                                    </td>
                                </tr>
                                <!-- ### SAMPLE ABOVE ### -->
                            </tbody>
                        </table>
                        <div>
                            <form>
                                <fieldset>
                                    <div class="form-textandbutton">
                                        <input type="text" id="input-licensekey" class="form-control input-mid" placeholder="New license number">
                                        <button id="btn-add" class="btn btn-primary"><span>Add</span></button>
                                    </div>
                                </fieldset>
                            </form>
                        </div>
                    </div>
                    <!-- /div .span8 -->
                </div>
                <!-- /div .row-fluid -->
            </div>
            <!-- /div .container-fluid -->
        </div>
        <!-- /div #mainsi -->
        
        <div id="footer" class="row-fluid">
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span8">
                        <div id="footer-links">
                            <ul>
                                <li><a href="#">Home</a></li>
                                <li><a href="#">{{Back to Central}}</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="span4">
                        <div class="pull-right">
                            &copy; 2008-2015 Winshuttle, LLC
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="modal fade js-initial-hide" id="js-modal-copymenu">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title">Copy License Key</h4>
                        <div class="js-zeroclipboard-unavailable-notice">
                            Select and copy the license key to your clipboard.
                        </div>
                    </div>
                    <div class="modal-body">
                        <textarea class="js-link-copy-target input-max"></textarea>
                    </div>
                    <div class="modal-footer js-initial-hide">
                        <button type="button" class="btn btn-primary js-link-copy" data-dismiss="modal"><span>Copy</span></button>
                        <button type="button" class="btn btn-default" data-dismiss="modal"><span>Cancel</span></button>
                    </div>
                </div>
            </div>
        </div>
        
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script>
            if (!window.jQuery) {
                console.error("jQuery CDN is down.")
                document.write('<script src="assets/js/jquery.min.js"><\/script>');
            }
        </script>
        <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
        <script>
            if (!$.fn.modal) {
                console.error("Bootstrap CDN is down.")
                document.write('<script src="assets/js/bootstrap.min.js"><\/script>');
            }
        </script>
        <script src="assets/js/kendo.all.min.js"></script>
        <script src="assets/js/chosen.jquery.min.js"></script>
        <script src="assets/js/ZeroClipboard.js"></script>
        <script src="assets/js/wslib_master.js"></script>
        <script src="assets/js/wsplugin_master.js"></script>
        <script src="assets/js/_ws_common.js"></script>
        <script>
            (function() {
                $("#btn-add").click(function () {
                    ws_showProgressBar();
                    var licenseKey = $("#input-licensekey").val();
                    ws_ajaxCall('/license/Add', { key: licenseKey }, add, onError, null);
                    return false;
                });

                function add(data, callbackdata) {
                    var row = createRow(data[0]);
                    $("#table-license > tbody:last").append(row);
                    attachEvents($("#table-license > tbody:last > tr:last"));

                    ws_hideProgressBar();
                }

                $(document).ready(function () {
                    ws_showProgressBar();
                    ws_initializeWebApp('/admin/getallwebapp', $('#select-webapp'), function () {
                        ws_ajaxCall('/license/getall', null, onLoad, onError, null);
                    });
                });

                function onLoad(data, callbackdata) {
                    $.each(data, function (key, value) {
                        var row = createRow(value);
                        $("#table-license > tbody:last").append(row);
                        attachEvents($("#table-license > tbody:last > tr:last"));
                    });

                    ws_hideProgressBar();
                }

                function createRow(rowData) {
                    var row = '<tr><td>' + rowData.HostName + '</td><td>' + rowData.Company + '</td><td>' + rowData.Processes + '</td><td>' + rowData.Expiration + '</td><td>' + rowData.Environment + '</td><td class="license-key"><a href="#" class="js-tooltip-target" title="<div class=\'interactive\'><div class=\'js-link-copy-target\'>' + rowData.Key + '</div><div class=\'copy-link-parent\'><a href=\'#\' class=\'js-link-copy\'>Copy License</a></div></div>">#####...</a></td><td><a href="#"><i class="icon-trash"></i></a></td></tr>';
                    return row;
                }

                function attachEvents(row) {
                    $(row).find(".icon-trash").click(function () {
                        ws_showProgressBar();
                        var hostName = $(row).find("td:first").html();
                        ws_ajaxCall('/license/delete', { hostName: hostName }, trash, onError, row);
                    });

                    $(row).find('a.js-tooltip-target').tooltip({
                        html: true,
                        trigger: 'click',
                        animation: true
                    });
                }

                function trash(data, callbackdata) {
                    $(callbackdata).remove();

                    ws_hideProgressBar();
                }

                function onError(xhr, status, error, callbackdata) {
                    ws_hideProgressBar();
                }
            })();
            
            
            
            
            
            (function() {
                var $licenseKeyCopiedAlert = $('#js-alert-licensekey-copied');
                var $copyTextModal = $('#js-modal-copymenu');
                var $copyTextTarget = $copyTextModal.find('.js-link-copy-target');
                var $copyTextUnavailableNotice = $copyTextModal.find('.js-zeroclipboard-unavailable-notice');
                
                $('body').on('click', '.js-modal-licensekey-target', function(event) {
                    event.preventDefault();

                    $copyTextTarget.val($(this).data('ws-licensekey'));
                });
                
                
                
                ZeroClipboard.config({
                    swfPath: "assets/swf/ZeroClipboard.swf"
                });

                var currentCopyPlugin = new ZeroClipboard($('.js-link-copy'));

                currentCopyPlugin.on('ready', function (event) {
                    $copyTextModal.find('.js-link-copy').parent().show();
                    $copyTextUnavailableNotice.hide();
                    
                    currentCopyPlugin.on('copy', function (event) {
                        var clipboard = event.clipboardData;

                        clipboard.setData("text/plain", $copyTextTarget.val());

                        $licenseKeyCopiedAlert.css('display', 'inline-block');

                        setTimeout(function () {
                            $licenseKeyCopiedAlert.slideUp();
                        }, 3000);
                    });
                });
            })();
        </script>
    </body>
</html>