<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Winshuttle</title>
        <link href="assets/css/kendo.common.min.css" rel="stylesheet">
        <link href="assets/css/kendo.default.min.css" rel="stylesheet">
        <link href="assets/css/kendo.dataviz.min.css" rel="stylesheet">
        <link href="assets/css/kendo.dataviz.default.min.css" rel="stylesheet">
        <link href="assets/css/chosen.css" rel="stylesheet">
        <link href="assets/css/winshuttle.css" rel="stylesheet">
        <link href="assets/css/ws-formitems.css" rel="stylesheet">
    </head>
    <body>
        <div id="workflow-header">
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span12">
                        <ul id="js-admincommands-relatedlinks">
                            <li class="related-label">Related:</li>
                            <li>
                                <a href="../Scheduler">Scheduler</a>
                            </li>
                            <li>
                                <a href="../Scheduler/PurgeServices">Purge Services</a>
                            </li>
                            <li>
                                <a href="../Scheduler/PurgeProcessData">Purge Process Data</a>
                            </li>
                            <li>
                                <a href="../Scheduler/ArchiveSolutionDef">Archive Solution Definition</a>
                            </li>
                            <li>
                                <a href="../Command?admincommandID=unmarkinactiveprocesses">Unmark Inactive Processes</a>
                            </li>
                        </ul>
                        <ul id="breadcrumbs">
                            <li><a href="#">Administration</a> &rsaquo;</li>
                            <li><a href="#">Scheduler</a></li>
                        </ul>
                        <ul id="secnav">
                            <li class="active">
                                <h1>Mark Inactive Processes</h1>
                                <div class="row-fluid">
                                    <div class="span8 page-description">Page description goes here.  If no page description exists, delete this paragraph.  Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span8">
                        <div class="settings-info">
                            <form class="form-horizontal">
                                <fieldset>
                                    <div class="control-group">
                                        <label class="control-label">Dry Run</label>
                                        <div class="controls">
                                            <ul class="checkbox-group">
                                                <li>                                                    
                                                    <label>
                                                        <input type="checkbox" id="dryRunChkBox" checked="checked"/>                                                        
                                                    </label>
                                                </li>                                            
                                            </ul>
                                        </div>
                                         <label class="control-label">Delete Inactive Processes</label>
                                        <div class="controls">
                                            <ul class="checkbox-group">
                                                <li>
                                                    <label>
                                                        <input type="checkbox" id="deleteInactiveProcessesChkBox" checked="checked"/>                                                        
                                                    </label>
                                                </li>                                               
                                            </ul>
                                        </div>
                                        <label class="control-label">Start Marking</label>
                                        <div class="controls">
                                            <ul class="inline-list checkbox-group">
                                                <li>
                                                    <label>
                                                    <input type="radio" name="startmarking"  id= "markInactiveNowRadio" class="js-startmarking-toggle-view-master-0" checked="checked" check-text="now" /> Now
                                                    </label>
                                                </li>
                                                <li>
                                                    <label>
                                                    <input type="radio" name="startmarking" id= "markInactiveScheduleRadio" class="js-startmarking-toggle-view-master-1" check-text="schedule"/> Schedule 
                                                    </label>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="js-startmarking-toggle-view-slave-1 control-group js-initial-hide">
                                        <label class="control-label">Day <span class="required">*</span></label>
                                        <div class="controls">
                                            <select class="input-large" id="markInactiveScheduleDayDropDown">
                                                <option value="1">First day of month</option>
                                                <option value="100">Last day of month</option>
                                                <option value="2">2nd</option>
                                                <option value="3">3rd</option>
                                                <option value="4">4th</option>
                                                <option value="5">5th</option>
                                                <option value="6">6th</option>
                                                <option value="7">7th</option>
                                                <option value="8">8th</option>
                                                <option value="9">9th</option>
                                                <option value="10">10th</option>
                                                <option value="11">11th</option>
                                                <option value="12">12th</option>
                                                <option value="13">13th</option>
                                                <option value="14">14th</option>
                                                <option value="15">15th</option>
                                                <option value="16">16th</option>
                                                <option value="17">17th</option>
                                                <option value="18">18th</option>
                                                <option value="19">19th</option>
                                                <option value="20">20th</option>
                                                <option value="21">21st</option>
                                                <option value="22">22nd</option>
                                                <option value="23">23rd</option>
                                                <option value="24">24th</option>
                                                <option value="25">25th</option>
                                                <option value="26">26th</option>
                                                <option value="27">27th</option>
                                                <option value="28">28th</option>
                                                <option value="29">29th</option>
                                                <option value="30">30th</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="js-startmarking-toggle-view-slave-1 control-group js-initial-hide">
                                        <label class="control-label">Time <span class="required">*</span></label>
                                        <div class="controls">
                                            <input class="js-kendo-timepicker input-onethirds" type="text" placeholder="HH:MM" id="markInactiveScheduleTimeDropDown"/>
                                        </div>
                                    </div>
                                    <div class="control-group">
                                        <label class="control-label">User(s) to Notify </label>
                                        <div class="controls">
                                            <input type="text" placeholder="user@winshuttle.com" class="input-max" id="usersToNotifyTxtBox"/>
                                        </div>
                                    </div>
                                    <div class="form-actions top-line">
                                        <button id="btnSave" class="btn btn-primary"><span>Save</span></button>
                                        <button class="btn"><span>Cancel</span></button>
                                    </div>
                                </fieldset>
                            </form>
                        </div>
                    </div>
                    <!-- /div .span8 -->
                </div>
                <!-- /div .row-fluid -->
            </div>
            <!-- /div .container-fluid -->
        </div>
        <!-- /div #mainsi -->
        
        <div id="footer" class="row-fluid">
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span8">
                        <div id="footer-links">
                            <ul>
                                <li><a href="#">Home</a></li>
                                <li><a href="#">{{Back to Central}}</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="span4">
                        <div class="pull-right">
                            &copy; 2008-2015 Winshuttle, LLC
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
         <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script>
            if (!window.jQuery) {
                console.error("jQuery CDN is down.")
                document.write('<script src="assets/js/jquery.min.js"><\/script>');
            }
        </script>
        <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
        <script>
            if (!$.fn.modal) {
                console.error("Bootstrap CDN is down.")
                document.write('<script src="assets/js/bootstrap.min.js"><\/script>');
            }
        </script>
        <script src="../../Content/assets/js/kendo.all.min.js"></script>
        <script src="../../Content/assets/js/chosen.jquery.min.js"></script>
        <script src="../../Content/assets/js/wslib_master.js"></script>
        <script src="../../Content/assets/js/wsplugin_master.js"></script>
        <script src="../../Content/assets/js/ws_admincommands.js"></script>        
        <script src="../../Content/assets/js/ws_common.js"></script>
        <script>
            $('.js-chosen-target').chosen({
                width: "33.3333333333%",
                disable_search: true
            });

            wsLib_toggleViews("startmarking", 2, "radio", "no", 200);

            $('input.js-kendo-timepicker').kendoTimePicker();


            $(document).ready(function () {
                //                ws_showProgressBar();
                ws_initializeWebApp("/admin/GetAllWebApp", $('#select-webapp'), function () {
                    var $id = wsPlugin_getURLParameter('id');
                    var $url = $("#select-webapp").val();
                    if ($id != null) {
                        ws_ajaxCall('/service/detail', { id: $id, url: $url }, function (data, callbackdata) {

                            var xml = data.Xml;
                            var xmlDocumentObj = loadXMLString(xml);

                            var isDryRun = $(xmlDocumentObj).find("IsDryRun").text();
                            var isDeleteProcesses = $(xmlDocumentObj).find("IsDeleteProcesses").text();
                            var usersToNotify = $(xmlDocumentObj).find("UsersToNotify").text();
                            var hostName = $(xmlDocumentObj).find("HostName").text();
                            var scheduleXml = $(xmlDocumentObj).find("ScheduleXml").text();

                            xmlDocumentObj = loadXMLString(scheduleXml);
                            var scheduleType = $(xmlDocumentObj).find("Type").text();
                            var scheduleDay = $(xmlDocumentObj).find("ScheduleDay").text();
                            var scheduleTime = $(xmlDocumentObj).find("ScheduleTime").text();

                            $("#dryRunChkBox").attr('checked', isDryRun.toLowerCase() === 'true');
                            $("#deleteInactiveProcessesChkBox").attr('checked', isDeleteProcesses.toLowerCase() === 'true');

                            if (scheduleType == 'now') {
                                $('#markInactiveNowRadio').prop('checked', true).change();
                            }
                            else {
                                $('#markInactiveScheduleRadio').prop('checked', true).change();
                                $("#markInactiveScheduleDayDropDown").val(scheduleDay);
                                $("#markInactiveScheduleTimeDropDown").val(scheduleTime);
                            }

                            $("#usersToNotifyTxtBox").val(usersToNotify);
                            $("#select-webapp").val(hostName);
                        }, null, null);
                    }
                });

            });

            function CallBackFunction(data, callbackdata) {
                alert(data);
                if (callbackdata != null) {
                    window.location.href = callbackdata;
                }
            }

            $("#btnSave").click(function () {
                var blnIsDryRun, blnIsDeleteInactiveProcesses, blnMarkInactiveNow, strScheduleType, strScheduleDay, strScheduleTime, strUserNotifyEmail;

                blnIsDryRun = $("#dryRunChkBox").prop('checked');
                blnIsDeleteInactiveProcesses = $("#deleteInactiveProcessesChkBox").prop('checked');

                //Getting Schedule Pattern
                blnMarkInactiveNow = $("#markInactiveNowRadio").prop('checked');
                strScheduleType = $("input[name=startmarking]:checked").attr('check-text');
                if (blnMarkInactiveNow == false) {
                    strScheduleDay = $("#markInactiveScheduleDayDropDown").val();
                    if (strScheduleDay.length == 0) {
                        return false;
                    }
                    strScheduleTime = $("#markInactiveScheduleTimeDropDown").val();
                    if (strScheduleTime.length == 0) {
                        return false;
                    }
                    strUserNotifyEmail = $("#usersToNotifyTxtBox").val();
                    if (strUserNotifyEmail.length == 0) {
                        return false;
                    }
                }

                //Getting HostName
                var strHostName = $("#select-webapp").val();
                if (strHostName.length == 0) {
                    return false;
                }

                var $id = wsPlugin_getURLParameter('id');

                if ($id == null) {
                    ws_ajaxCall('/Scheduler/CreateMarkInactiveProcessesEntry',
                            {
                                isDryRun: blnIsDryRun,
                                isDeleteInactiveProcesses: blnIsDeleteInactiveProcesses,
                                isMarckInactiveNow: blnMarkInactiveNow,
                                scheduleType: strScheduleType,
                                scheduleDay: strScheduleDay,
                                scheduleTime: strScheduleTime,
                                usersToNotify: strUserNotifyEmail,
                                hostName: strHostName
                            },
                              CallBackFunction, null,
                              null);
                } else {
                    var sourceUrl = wsPlugin_getURLParameter('source');
                    ws_ajaxCall('/Scheduler/UpdateMarkInactiveProcessesEntry',
                            {
                                id: $id,
                                isDryRun: blnIsDryRun,
                                isDeleteInactiveProcesses: blnIsDeleteInactiveProcesses,
                                isMarckInactiveNow: blnMarkInactiveNow,
                                scheduleType: strScheduleType,
                                scheduleDay: strScheduleDay,
                                scheduleTime: strScheduleTime,
                                usersToNotify: strUserNotifyEmail,
                                hostName: strHostName
                            },
                              CallBackFunction, null,
                              sourceUrl);
                }
                return false;
            });
        </script>	
    </body>
</html>