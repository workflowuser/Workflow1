<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Winshuttle - Configure Options</title>
        <link href="assets/css/kendo.common.min.css" rel="stylesheet">
        <link href="assets/css/kendo.default.min.css" rel="stylesheet">
        <link href="assets/css/kendo.dataviz.min.css" rel="stylesheet">
        <link href="assets/css/kendo.dataviz.default.min.css" rel="stylesheet">
        <link href="assets/css/winshuttle.css" rel="stylesheet">
        <link href="assets/css/ws-formitems.css" rel="stylesheet">
    </head>
    <body>
        <div id="workflow-header">
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span6">
                        <div class="workflow-brand">
                            <img src="assets/img/ws-logo-workflow.png" alt="Winshuttle">
                            <div class="home-dropdown">
                                <div class="btn-group">
                                    <a class="btn btn-action dropdown-toggle" data-toggle="dropdown" href="#"></a>
                                    <ul class="dropdown-menu">
                                        <div>
                                            <li class="dropdown-title">Logs &amp; Reporting</li>
                                            <li><a href="#">Charts</a></li>
                                            <li><a href="#">Excel Data Dump</a></li>
                                            <li><a href="#">Logging</a></li>
                                            <li><a href="#">Log File Viewer</a></li>
                                            <li class="dropdown-title">Processes</li>
                                            <li><a href="#">Process Control</a></li>
                                            <li><a href="#">Manage Background Jobs</a></li>
                                        </div>
                                        <div>
                                            <li class="dropdown-title">Server Administration</li>
                                            <li><a href="#">Admin Commands</a></li>
                                            <li><a href="#">Configure Options</a></li>
                                            <li><a href="#">Scheduler</a></li>
                                            <li><a href="#">Workflow Extensions</a></li>
                                            <li><a href="#">Database Status</a></li>
                                            <li><a href="#">Licenses</a></li>
                                        </div>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="span6">
                        <ul class="inline-list pull-right">
                            <!--<li>
                                <a class="font-white" href="javascript:;">&#9664; Winshuttle Central</a>
                                </li>-->
                            <li>
                                <select class="input-medium" id="webappsDropdown">                                    
                                </select>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div id="mainsi">
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span12">
                        <ul id="breadcrumbs">
                            <li><a href="#">Administration</a> &rsaquo;</li>
                            <li><a href="#">Server Administration</a> &rsaquo;</li>
                            <li class="related-links">
                                <ul>
                                    <li class="related-label">Related:</li>
                                    <li class="link"><a href="#">Configuration Documentation</a></li>
                                </ul>
                            </li>
                        </ul>
                        <ul id="secnav">
                            <li class="pull-right">
                                <button class="btn pull-right"><span>Add Configuration</span></button>
                            </li>
                            <li class="active">
                                <h1>Configure Options</h1>
                                <p class="page-description">Page description goes here.  If no page description exists, delete this paragraph.  Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="row-fluid">
                    <table class="table table-header">
                        <tbody>
                            <tr>
                                <td>
                                    <form>
                                        <div>
                                            <label>Name Contains</label>
                                            <input type="text" class="form-control input-large" placeholder="">
                                        </div>
                                        <div>
                                            
                                            
                                            
                                            <label>Scope</label>
                                            
                                            <div>
                                                <div id="treeviewdropdown" class="js-dropdowntree-target dropdown-tree-menu input-large">
                                                    <div class="dropdown">
                                                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                                            <span class="js-administration-dropdowntree-select-display">All Sites & Lists</span>
                                                            <span class="dropdown-toggle-symbol"></span>
                                                        </a>
                                                        <ul class="dropdown-menu">
                                                            
                                                            <li class="js-administration-dropdowntree-group">
                                                                <a data-corresponding-value-type="-1" href="#"><span>All Sites & Lists</span></a>
                                                            </li>
                                                            <li class="js-administration-dropdowntree-group">
                                                                <a data-corresponding-value-type="10002" href="#"><span>Global</span></a>
                                                            </li>
                                                            <li class="js-administration-dropdowntree-group">
                                                                <a data-corresponding-value-type="10001" href="#"><span>formex/</span></a>
                                                                <ul>
                                                                    <li><a data-corresponding-value-type="10003" href="#"><span>Announcements</span></a></li>
                                                                    <li><a class="js-menu-inactive" data-corresponding-value-type="10004" href="#"><span>Calendar</span></a></li>
                                                                    <li><a data-corresponding-value-type="10005" href="#"><span>Tasks</span></a></li>
                                                                </ul>
                                                            </li>
                                                            <li class="js-administration-dropdowntree-group">
                                                                <a class="js-menu-inactive" data-corresponding-value-type="10006" href="#"><span>Site B/</span></a>
                                                            </li>
                                                            <li class="js-administration-dropdowntree-group">
                                                                <a data-corresponding-value-type="10007" href="#"><span>Site C/</span></a>
                                                                <ul>
                                                                    <li><a class="js-menu-inactive" data-corresponding-value-type="10008" href="#"><span>List 12</span></a></li>
                                                                </ul>
                                                            </li>
                                                            
                                                            <li class="js-administration-dropdowntree-group">
                                                                <a data-corresponding-value-type="11007" href="#"><span>DeepTest/</span></a>
                                                                <ul>
                                                                    <li>
                                                                        <a data-corresponding-value-type="12007" href="#"><span>L1/</span></a>
                                                                        <ul>
                                                                            <li><a data-corresponding-value-type="12008" href="#"><span>L2.1</span></a></li>
                                                                            <li>
                                                                                <a data-corresponding-value-type="13007" href="#"><span>L2.2P/</span></a>
                                                                                <ul>
                                                                                    <li><a data-corresponding-value-type="13008" href="#"><span>L3</span></a></li>
                                                                                </ul>
                                                                            </li>
                                                                        </ul>
                                                                    </li>
                                                                </ul>
                                                            </li>
                                                            
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                        </div>
                                        <div>
                                            <label>Display Keys</label>
                                            <select name="" id="keyvaluestatusdropdown" class="input-large">
                                                <option selected="selected" value="1">With Values Assigned</option>
                                                <option value="2">With NO Values Assigned</option>
                                                <option value="3">All available Keys</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label>&nbsp;</label>
                                            <button class="btn btn-primary"><span>Search</span></button>
                                        </div>
                                    </form>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- /div .row-fluid -->
                <div class="row-fluid">
                    <table id="table-KeysData" class="table table-striped table-bordered">
                        <thead>
                            <tr class="table-menu">
                                <th colspan="8">
                                    <div class="display">
                                        <span>Displaying 1 - 50 of 125 </span>
                                        <select name="" id="dropdownpagesize" class="input-small">
                                            <option selected="selected" value="10">10</option>
                                            <option value="20">20</option>
                                            <option value="30">30</option>
                                            <option value="40">40</option>
                                            <option value="50">50</option>
                                            <option value="100">100</option>
                                            <option value="200">200</option>
                                            <option value="300">300</option>
                                            <option value="400">400</option>
                                            <option value="500">500</option>
                                        </select>
                                    </div>
                                </th>
                            </tr>
                            <tr class="table-sort">
                                <th width="25%"><a href="#">Name</a></th>
                                <th width="15%"><a href="#">Assigned to</a></th>
                                <th width="5%"><a href="#">Type</a></th>
                                <th width="55%"><a href="#">Description</a></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><a href="#">AdHocRouterEnabled</a> <a href="#" class="edit"><i class="icon-edit"></i></a></td>
                                <td>Site A, Site AB/List</td>
                                <td>boolean</td>
                                <td>Determines whether or not choosing Route in the context menu in ShareVis Explorer allows the user to create an ad hoc route.</td>
                            </tr>                          
                        </tbody>
                    </table>
                    <ul class="pagination">
                        <li><a href="#" class="btn btn-disabled"><span>&larr;</span></a></li>
                        <li><a href="#" class="btn btn-primary"><span>1</span></a></li>
                        <li><a href="#" class="btn"><span>2</span></a></li>
                        <li><a href="#" class="btn"><span>3</span></a></li>
                        <li><a href="#" class="btn"><span>&rarr;</span></a></li>
                    </ul>
                </div>
            </div>
            <!-- /div .container-fluid -->
        </div>
        <!-- /div #mainsi -->
        
        <div id="footer" class="row-fluid">
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span8">
                        <div id="footer-links">
                            <ul>
                                <li><a href="#">Home</a></li>
                                <li><a href="#">{{Back to Central}}</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="span4">
                        <div class="pull-right">
                            &copy; 2008-2015 Winshuttle, LLC
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script>
            if (!window.jQuery) {
                console.error("jQuery CDN is down.")
                document.write('<script src="assets/js/jquery.min.js"><\/script>');
            }
        </script>
        <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
        <script>
            if (!$.fn.modal) {
                console.error("Bootstrap CDN is down.")
                document.write('<script src="assets/js/bootstrap.min.js"><\/script>');
            }
        </script>
        <script src="assets/js/kendo.all.min.js"></script>
        <script src="assets/js/wslib_master.js"></script>
        <script src="assets/js/wsplugin_master.js"></script>
        <script src="assets/js/ws_admincommands.js"></script>
        <script src="assets/js/ws_common.js" type="text/javascript"></script>
        <script>
            (function() {
                $('.js-dropdowntree-target').each(function() {
                    var $currentDropdownTreeSelectTarget = $(this);
                    
                    $currentDropdownTreeSelectTarget.find('.js-menu-inactive').on('click.preventInactiveEvents', function(event) {
                        event.stopImmediatePropagation();
                        event.preventDefault();
                    });
                    
                    $currentDropdownTreeSelectTarget.on('click.scrollToItem', '.dropdown-toggle', function(event) {
                        event.preventDefault();
                        
                        var activeValueType = $currentDropdownTreeSelectTarget.data('active-value-type');

                        if(activeValueType !== undefined) {
                            setTimeout(function() {
                                var targetScrollTop = $currentDropdownTreeSelectTarget.find('.dropdown-menu')
                                                                                         .scrollTop(0)
                                                                                         .find('a')
                                                                                         .filter('[data-corresponding-value-type="' + activeValueType + '"]')
                                                                                         .first()
                                                                                         .closest('li.js-administration-dropdowntree-group')
                                                                                         .position()
                                                                                         .top;

                                $currentDropdownTreeSelectTarget.find('.dropdown-menu').scrollTop(targetScrollTop);
                            }, 1);
                        }
                    }).on('click.chooseNewItem', '.dropdown-menu a', function(event) {
                        event.preventDefault();

                        var $this = $(this);



                        function generateValueTypeLabel($whichLink) {
                            var currentText = $whichLink.text();

                            if(currentText === '') {
                                return currentText;
                            }
                            else {
                                return generateValueTypeLabel($whichLink.closest('ul').siblings('a').not('.dropdown-toggle')) + currentText;
                            }
                        }

                        var typeName = generateValueTypeLabel($this);



                        $this.closest('.dropdown')
                             .children('.dropdown-toggle')
                             .children('.js-administration-dropdowntree-select-display')
                             .text(typeName)
                             .data('selected-value-type', {
                                 type: typeName
                             });

                        var addNewValueSelected = parseInt($this.data('corresponding-value-type'));

                        $currentDropdownTreeSelectTarget.data('active-value-type', addNewValueSelected);
                    });
                });
            })();
            
            $(document).ready(function () {
                ws_initializeWebApp("/admin/GetAllWebApp", $('#webappsDropdown'), GetAllKeys);

                $("#dropdownpagesize").change(function () {
                    GetAllKeys();
                });

                $("#btnSearch").click(function () {
                    GetAllKeys();
                });

                function GetAllKeys() {
                    ws_ajaxCall('/keyconfiguration/GetKeys', { server: $('#webappsDropdown').val(),
                        siteguid: '3c571b87-6b39-42ed-8fd4-d8847e1e335e',
                        webguid: '7bb86209-0623-455f-8dfd-709594b53702',
                        listguid: 'All',
                        type: 'global',
                        havingvalues: $("#keyvaluestatusdropdown").val(),
                        pagenumber: 1,
                        pagesize: $("#dropdownpagesize").val()
                    }, CallBackSuccess, CallBackFunctionFailure, null);

                }

                function CallBackSuccess(data) {
                    $('#table-KeysData > tbody tr').remove();
                    var pageCount = null;
                    var keyCount = null;
                    var keys = null;
                    if (data.PageCount != undefined && data.PageCount != null) {
                        pageCount = data.PageCount;
                    }

                    if (data.KeyCount != undefined && data.KeyCount != null) {
                        keyCount = data.KeyCount;
                    }

                    if (data.Keys != undefined && data.Keys != null) {
                        keys = data.Keys;
                        var xmlDocument = loadXMLString(keys);
                        var keys = xmlDocument.selectNodes("/Keys/Key");
                        if (keys != undefined && keys != null && keys.length > 0) {
                            $.each(keys, function (k, v) {
                                var row = CreateRow(v);
                                $("#table-KeysData > tbody:last").append(row);
                            });
                        }
                        //alert(keys.length);
                    }
                }

                function CreateRow(node) {
                    var markup = null;
                    if (node != null) {
                        var Name = node.getAttribute("Name");
                        var Type = node.getAttribute("Type");
                        var Description = node.getAttribute("Description");
                        var childNodes = node.selectNodes("./KeyAssignment");
                        var AssignedTo = '';
                        if (childNodes != null && childNodes != undefined && childNodes.length > 0) {
                            for (var i = 0; i < childNodes.length; i++) {
                                AssignedTo += childNodes[i].getAttribute("AssignedTo") + ", ";
                            }
                        }

                        AssignedTo = AssignedTo.trim().replace(/(^,)|(,$)/g, "");
                        var url = encodeURI("configure-edit.html?k=" + Name + "&server=" + $('#webappsDropdown').val());
                        markup = '<tr>' +
                                        '<td><a href="' + url + '">' + Name + '</a> <a href="#" class="edit"><i class="icon-edit"></i></a></td>' +
                                        '<td>' + AssignedTo + '</td>' +
                                        '<td>' + Type + '</td>' +
                                        '<td>' + Description + '</td>' +
                                 '</tr> ';
                    }

                    return markup;
                }

                function CallBackFunctionFailure(xhr, status, error, callbackdata) {
                    if (xhr.responseText != null && xhr.responseText != undefined) {
                        alert("Status: " + xhr.Status + ", Error: " + xhr.responseText);
                    }
                }
            });

        </script>
    </body>
</html>