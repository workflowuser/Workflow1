<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Winshuttle - Process Control</title>
        <link href="assets/css/kendo.common.min.css" rel="stylesheet">
        <link href="assets/css/kendo.default.min.css" rel="stylesheet">
        <link href="assets/css/kendo.dataviz.min.css" rel="stylesheet">
        <link href="assets/css/kendo.dataviz.default.min.css" rel="stylesheet">
        <link href="assets/css/winshuttle.css" rel="stylesheet">
        <link href="assets/css/ws-formitems.css" rel="stylesheet">
    </head>
    <body>
        <div id="workflow-header">
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span6">
                        <div class="workflow-brand">
                            <img src="assets/img/ws-logo-workflow.png" alt="Winshuttle"/>
                            <div class="home-dropdown">
                                <div class="btn-group">
                                    <a class="btn btn-action dropdown-toggle" data-toggle="dropdown" href="#"></a>
                                    <ul class="dropdown-menu">
                                        <div>
                                            <li class="dropdown-title">Logs &amp; Reporting</li>
                                            <li><a href="#">Charts</a></li>
                                            <li><a href="#">Excel Data Dump</a></li>
                                            <li><a href="#">Logging</a></li>
                                            <li><a href="#">Log File Viewer</a></li>
                                            <li class="dropdown-title">Processes</li>
                                            <li><a href="#">Process Control</a></li>
                                            <li><a href="#">Manage Background Jobs</a></li>
                                        </div>
                                        <div>
                                            <li class="dropdown-title">Server Administration</li>
                                            <li><a href="#">Admin Commands</a></li>
                                            <li><a href="#">Configure Options</a></li>
                                            <li><a href="#">Scheduler</a></li>
                                            <li><a href="#">Workflow Extensions</a></li>
                                            <li><a href="#">Database Status</a></li>
                                            <li><a href="#">Licenses</a></li>
                                        </div>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="span6">
                        <ul class="display-inline-children pull-right">
                            <!--<li>
                                <a class="font-white" href="javascript:;">&#9664; Winshuttle Central</a>
                                </li>-->
                            <li>
                                <select class="input-medium" id="select-webapp"></select>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div id="mainsi">
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span12">
                        <ul id="breadcrumbs">
                            <li><a href="#">Administration</a> &rsaquo;</li>
                            <li><a href="#">Server Administration</a></li>
                            <li class="related-links">
                                <ul>
                                    <li class="related-label">Related:</li>
                                    <li class="link"><a href="#">Background Jobs</a></li>
                                    <li class="link"><a href="#">Scheduler</a></li>
                                </ul>
                            </li>
                        </ul>
                        <ul id="secnav">
                            <li class="active">
                                <h1>Process Control</h1>
                                <p class="page-description">Page description goes here.  If no page description exists, delete this paragraph.  Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="row-fluid">
                    <table class="table table-header">
                        <tbody>
                            <tr>
                                <td>
                                    <form>
                                        <div>
                                            <label>Server</label>
                                            <select name="webapp" id="select-server" class="input-medium">
                                                <option selected="selected" value="%">All</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label>Site</label>
                                            <select name="site" id="select-site" class="input-small">
                                                <option selected="selected" value="%">All</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label>Status</label>
                                            <select name="procStatus" id="select-status" class="input-small">
                                                <option selected="selected" value="%">All</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label>Definition</label>
                                            <select name="procDef" id="select-def" class="input-small">
                                                <option selected="selected" value="%">All</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label>Process name contains</label>
                                            <input type="text" id="input-process" class="form-control input-large" placeholder="">
                                        </div>
                                        <div>
                                            <label>Doc/Form</label>
                                            <select name="docOrForm" id="select-docform" class="input-small">
                                                <option selected="selected" value="%">All</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label>Originator</label>
                                            <select name="originator" id="select-originator" class="input-small">
                                                <option selected="selected" value="%">All</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label>Overdue</label>
                                            <select name="overdueDate" id="select-overdue" class="input-mini"></select>
                                        </div>
                                        <div>
                                            <label>&nbsp;</label>
                                            <div class="input-btn-primary">
                                                <input class="btn input-btn-primary" id="btn-submit" type="button" name="" value="Search">
                                            </div>
                                        </div>
                                    </form>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="row-fluid">
                    <table class="table table-striped table-bordered" id="tbl-process-control">
                        <thead>
                            <tr class="table-menu">
                                <th colspan="11">
                                    <div class="js-administration-processcontrol-visiblefor-runningprocess js-initial-hide">
                                        <input type="text" class="form-control input-large" placeholder="Comments">
                                    </div>
                                    <div class="input-btn js-administration-processcontrol-visiblefor-runningprocess js-initial-hide">
                                        <input class="btn" type="submit" name="" value="cancel">
                                    </div>
                                    <div class="input-btn js-administration-processcontrol-visiblefor-runningprocess js-initial-hide">
                                        <input class="btn" type="submit" name="" value="reject">
                                    </div>
                                    <div class="input-btn js-administration-processcontrol-visiblefor-runningprocess js-initial-hide">
                                        <input class="btn" type="submit" name="" value="approve">
                                    </div>
                                    <div class="display">
                                        <span>Displaying 1 - 50 of 125 <a href="#">Export</a></span>
                                        <select name="" id="select-pagesize" onchange="" class="input-small">
                                            <option selected="selected" value="50">50</option>
                                            <option value="100">100</option>
                                            <option value="200">200</option>
                                            <option value="500">500</option>
                                        </select>
                                    </div>
                                </th>
                            </tr>
                            <tr>
                                <th title="checkbox" width="2%">
                                    <span title="Select All">
                                    <input class="js-processcontrol-check-all-master" type="checkbox" name="" onclick="selectAll(this);">
                                    </span>
                                </th>
                                <th><a href="#">ID</a></th>
                                <th><a href="#">Status</a></th>
                                <th><a href="#">Site</a></th>
                                <th><a href="#">Definition</a></th>
                                <th><a href="#">Process</a></th>
                                <th><a href="#">Originator</a></th>
                                <th><a href="#">Created</a></th>
                                <th><a href="#">Completed</a></th>
                                <th><a href="#">Days</a></th>
                                <th><a href="#">Due on</a></th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <ul class="pagination">
                        <li><a href="#" class="btn btn-disabled"><span>&larr;</span></a></li>
                        <li><a href="#" class="btn btn-primary"><span>1</span></a></li>
                        <li><a href="#" class="btn"><span>2</span></a></li>
                        <li><a href="#" class="btn"><span>3</span></a></li>
                        <li><a href="#" class="btn"><span>&rarr;</span></a></li>
                    </ul>
                </div>
            </div>
            <!-- /div .container-fluid -->
        </div>
        <!-- /div #mainsi -->
        <div id="footer" class="row-fluid">
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span8">
                        <div id="footer-links">
                            <ul>
                                <li><a href="#">Help</a></li>
                                <li><a href="#">About</a></li>
                                <li><a href="#">Terms</a></li>
                                <li><a href="#">Privacy Policy</a></li>
                            </ul>
                            <ul>
                                <li>&copy; 2008-2011 Winshuttle, LLC</li>
                                <li>Version 10.4</li>
                                <li>Privacy Mode: Secure</li>
                            </ul>
                        </div>
                    </div>
                    <div class="span4">
                        <ul class="security-logo">
                            <li><img src="assets/img/security-te.png" alt="TRUSTe"/></li>
                            <li><img src="assets/img/security-sh.png" alt="Safe Harbor"/></li>
                            <li><img src="assets/img/security-soc.png" alt="SSAE 16 / ISAE 3402 Type II SOC 1"/></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script>
            if (!window.jQuery) {
                console.error("jQuery CDN is down.")
                document.write('<script src="assets/js/jquery.min.js"><\/script>');
            }
        </script>
        <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
        <script>
            if (!$.fn.modal) {
                console.error("Bootstrap CDN is down.")
                document.write('<script src="assets/js/bootstrap.min.js"><\/script>');
            }
        </script>
        <script src="assets/js/kendo.all.min.js"></script>
        <script src="assets/js/chosen.jquery.min.js"></script>
        <script src="assets/js/wslib_master.js"></script>
        <script src="assets/js/wsplugin_master.js"></script>
        <script src="assets/js/ws_global_initialization_administration.js"></script>
        <script src="assets/js/ws_common.js"></script>
        <script src="assets/js/jquery.tmpl.js"></script>
        <script>
            $('a.js-tooltip-target').tooltip({
                html: true,
                trigger: 'click',
                animation: true
            });
            
            $('body').on('click', '.js-tooltip-target', function(event) {
                event.stopPropagation();
                
                $('div.tooltip').not($(this).siblings('div.tooltip')).remove();
            });
            
            var $administrationProcessControlCommentsButtons = $('div.js-administration-processcontrol-visiblefor-runningprocess');
            
            wsLib_checkAll('processcontrol', undefined, {
                empty: function() {
                    $administrationProcessControlCommentsButtons.fadeOut();
                },
                partial: function() {
                    $administrationProcessControlCommentsButtons.fadeIn();
                },
                full: function() {
                    $administrationProcessControlCommentsButtons.fadeIn();
                },
                toggleCheckbox: {
                    single: function(whichState, $whichCheckbox) {
                        wsLib_console({
                            whichState: whichState,
                            whichCheckbox: $whichCheckbox,
                            status: $whichCheckbox.data('status')
                        });
                    },
                    all: function(whichState) {
                        
                    }
                }
            });

            $(document).ready(function () {

                ws_initializeWebApp('/admin/getallwebapp', $('#select-webapp'), function (data) {

                    var option = '';

                    $.each(data, function (k, v) {
                        option += '<option value="' + v.WebAppUrl + '">' + v.Name + '</option>';
                    });

                    $('#select-server option').remove();
                    $('#select-server').append(option);
                    var server = $('#select-server option:selected').val();
                    ws_ajaxCall('/admin/GetAllSites', { server: server }, fillSites, onError, null);
                    ws_ajaxCall('/workflowprocess/GetControls', { webapp: server }, fillControls, onError, null);
                });

                $('#select-server').on('change', function () {

                    var webapp = $('#select-server option:selected').val();
                    ws_ajaxCall('/workflowprocess/GetControls', { webapp: webapp }, fillControls, onError, null);
                    ws_ajaxCall('/admin/GetAllSites', { server: webapp }, fillSites, onError, null);
                });

                $('#btn-submit').on('click', function () {
                    loadProcess(1);
                });
            });

            function loadProcess(curPage) {

                var webapp = $('#select-server option:selected').val();
                var site = $('#select-site option:selected').val();
                var procDef = $('#select-def option:selected').val();
                var originator = $('#select-originator option:selected').val();
                var overdue = $('#select-overdue option:selected').val();
                var status = $('#select-status option:selected').val();
                var docform = $('#select-docform option:selected').val();
                var pageSize = $('#select-pagesize option:selected').val();
                var procName = $('#input-process').val();

                var data = { webapp: webapp, site: site, procDef: procDef, originator: originator, overdueDate: overdue, procStatus: status, docOrForm: docform, procName: procName, pageSize: pageSize, curPage: curPage };
                ws_ajaxCall('/workflowprocess/fetch', data, fillProcessData, onError, null);
            }

            function fillProcessData(data, callbackData) {

                $('#tbl-process-control tbody tr').remove();
                var rows = $('#process-control-tmpl').tmpl(data);
                $('#tbl-process-control tbody').append(rows);

                wsLib_checkAll('processcontrol', undefined, {
                    empty: function () {
                        $administrationProcessControlCommentsButtons.fadeOut();
                    },
                    partial: function () {
                        $administrationProcessControlCommentsButtons.fadeIn();
                    },
                    full: function () {
                        $administrationProcessControlCommentsButtons.fadeIn();
                    },
                    toggleCheckbox: {
                        single: function (whichState, $whichCheckbox) {
                            wsLib_console({
                                whichState: whichState,
                                whichCheckbox: $whichCheckbox,
                                status: $whichCheckbox.data('status')
                            });
                        },
                        all: function (whichState) {

                        }
                    }
                });
            }

            function fillControls(data, callbackdata) {

                fillStatus(data.AllStatus);
                fillDef(data.ProcDef);
                fillDocOrForm(data.DocOrForm);
                fillOriginator(data.Originator);
                fillOverdue(data.Overdue);
            }

            function fillStatus(data) {
                var option = '';

                $.each(data, function (k, v) {
                    option += '<option value="' + v.ProcessStatus + '">' + v.ProcessStatus + '</option>';
                });

                $('#select-status option:not(:first)').remove();
                $('#select-status').append(option);
            }

            function fillOverdue(data) {
                var option = '';

                $.each(data, function (k, v) {
                    option += '<option value="' + v.Value + '">' + v.Name + '</option>';
                });

                $('#select-overdue option').remove();
                $('#select-overdue').append(option);
            }

            function fillDef(data) {
                var option = '';

                $.each(data, function (k, v) {
                    option += '<option value="' + v.ProcessDefinitionName + '">' + v.ProcessDefinitionName + '</option>';
                });

                $('#select-def option:not(:first)').remove();
                $('#select-def').append(option);
            }

            function fillDocOrForm(data) {
                var option = '';

                $.each(data, function (k, v) {
                    option += '<option value="' + v.DocOrForm + '">' + v.DocOrForm + '</option>';
                });

                $('#select-docform option:not(:first)').remove();
                $('#select-docform').append(option);
            }

            function fillOriginator(data) {
                var option = '';

                $.each(data, function (k, v) {
                    option += '<option value="' + v.Originator + '">' + v.Originator + '</option>';
                });

                $('#select-originator option:not(:first)').remove();
                $('#select-originator').append(option);
            }

            function fillSites(data) {
                var options = '';
                $.each(data, function (key, value) {
                    options += '<option value="' + value.URL + '">' + value.Name + '</option>';
                });

                $("#select-site option:not(:first)").remove();
                $("#select-site").append(options);
            }

            function onError() {

            }
            
        </script>

        <script id="process-control-tmpl" type="text/x-jQuery-tmpl">
        <tr>
            <td class="js-processcontrol-check-all-slaves" title="checkbox" width="2%">
            {{if ProcessStatus == 'Running'}}
            <input type="checkbox" data-status="${ProcessStatus}">
            {{/if}}
            </td>
            <td>${ProcessId}</td>
            <td class="process-status">
            {{if ProcessStatus == 'Completed'}}
            <span class="icon-status-complete"></span>
            {{/if}}
            {{if ProcessStatus == 'Approved'}}
            <span class="icon-status-approved"></span>
            {{/if}}
            {{if ProcessStatus == 'Cancelled'}}
            <span class="icon-status-cancelled"></span>
            {{/if}}
            {{if ProcessStatus == 'Running'}}
            <span class="icon-status-running"></span>
            {{/if}}
            ${ProcessStatus}</td>
            <td>${ContextPath}</td>
            <td>${ProcessDefinitionName}</td>
            <td>${TaskItemTitle}</td>
            <td>${Originator}</td>
            <td>${CreationDate}</td>
            <td>${CompletionDate}</td>
            <td>${Duration}</td>
            <td>${DueDate}</td>
        </tr>
        </script>
    </body>
</html>